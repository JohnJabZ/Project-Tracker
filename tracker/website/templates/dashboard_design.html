{% extends 'base.html' %}

{% block content %}
{% if user.is_authenticated %}
<style>
    .dashboard-card {
        border-radius: 14px;
        transition: all 0.25s ease-in-out;
    }

    .dashboard-card:hover {
        transform: translateY(-4px);
        box-shadow: 0px 6px 14px rgba(0, 0, 0, 0.15) !important;
    }

    .dashboard-card h2 a:hover {
        opacity: 0.8;
    }
</style>

<div class="container mt-4">

    <h3 class="mb-4 fw-bold text-center">Design Overview Dashboard</h3>

    <div class="row g-4 mb-5">

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Total Projects</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'design' %}" class="text-decoration-none" style="color: #0d6efd;">
                            {{ total }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">For Survey</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'design_filter' 'for_survey' %}" class="text-decoration-none"
                            style="color: #ffc107;">
                            {{ for_survey }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">For Submission</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'design_filter' 'for_submission' %}" class="text-decoration-none"
                            style="color: #fd7e14;">
                            {{ for_submission }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">For Approval</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'design_filter' 'for_approval' %}" class="text-decoration-none"
                            style="color: #0dcaf0;">
                            {{ for_approval }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Completed</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'design_filter' 'completed' %}" class="text-decoration-none"
                            style="color: #198754;">
                            {{ completed }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">For Cancellation</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'design_filter' 'for_cancellation' %}" class="text-decoration-none"
                            style="color: #6c757d;">
                            {{ for_cancellation }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Cancelled</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'design_filter' 'cancelled' %}" class="text-decoration-none"
                            style="color: #dc3545;">
                            {{ cancelled }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

    </div>

    <div class="card shadow p-4 border-0" style="border-radius: 14px;">
        <h4 class="text-center fw-bold mb-4">Design Status Chart</h4>
        <canvas id="statusPieChart" style="max-height: 360px;"></canvas>
    </div>

</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('statusPieChart').getContext('2d');

    // Define consistent and UNIQUE colors for each stage (matching card inline styles)
    const pieChartBackgroundColors = [
        // For Survey: Warning Yellow
        '#ffc107',
        // For Submission: Deep Orange
        '#fd7e14',
        // For Approval: Info Cyan
        '#0dcaf0',
        // Completed: Success Green
        '#198754',
        // For Cancellation: Secondary Gray
        '#6c757d',
        // Cancelled: Danger Red
        '#dc3545',
    ];

    new Chart(ctx, {
        type: 'pie',
        data: {
            // The order of these labels MUST match the order of data and colors
            labels: ['For Survey', 'For Submission', 'For Approval', 'Completed', 'For Cancellation', 'Cancelled'],
            datasets: [{
                data: [
                    Number("{{ for_survey }}"),
                    Number("{{ for_submission }}"),
                    Number("{{ for_approval }}"),
                    Number("{{ completed }}"),
                    Number("{{ for_cancellation }}"),
                    Number("{{ cancelled }}")
                ],
                backgroundColor: pieChartBackgroundColors // Using the precise, matching colors
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { position: 'bottom' } }
        }
    });
</script>

{% else %}
<div class="container text-center mt-5">
    <h1 class="display-5 fw-bold">Telecom Project Tracker</h1>
    <p class="lead mt-3">A centralized platform for managing telecom construction projects from planning to invoicing.
    </p>
    <a href="{% url 'register' %}" class="btn btn-outline-success btn-lg mt-4 px-5">Get Started</a>
</div>
{% endif %}
{% endblock %}
{% extends 'base.html' %}

{% block content %}
{% if user.is_authenticated %}

<style>
    .dashboard-card {
        border-radius: 14px;
        transition: all 0.25s ease-in-out;
    }

    .dashboard-card:hover {
        transform: translateY(-4px);
        box-shadow: 0px 6px 14px rgba(0, 0, 0, 0.15) !important;
    }

    .dashboard-card h2 a:hover {
        opacity: 0.8;
    }
</style>

<div class="container mt-4">
    <h3 class="text-center fw-bold mb-4">Survey Overview Dashboard</h3>

    <div class="row g-4 mb-5">

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Total Projects</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey' %}" class="text-decoration-none" style="color: #2070e0;">
                            {{ total }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Overlapping Clearance</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'overlapping' %}" class="text-decoration-none"
                            style="color: #f8b800;">
                            {{ overlapping }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Parceling Stage</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'parceling' %}" class="text-decoration-none"
                            style="color: #00c0c0;">
                            {{ parceling }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">GIS Post</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'gis_post' %}" class="text-decoration-none"
                            style="color: #495057;">
                            {{ gis_post }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Survey Tool Access</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'tool_access' %}" class="text-decoration-none"
                            style="color: #6c757d;">
                            {{ tool_access }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Survey Stage</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'survey_stage' %}" class="text-decoration-none"
                            style="color: #5cb85c;">
                            {{ survey_stage }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Cluster ID Acquisition</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'cluster_id' %}" class="text-decoration-none"
                            style="color: #6f42c1;">
                            {{ cluster_id }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">HLD Submission</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'hld_submission' %}" class="text-decoration-none"
                            style="color: #2070e0;">{{ hld_submission }}</a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">HLD Approval</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'hld_approval' %}" class="text-decoration-none"
                            style="color: #fd7e14;">
                            {{ hld_approval }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Completed</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'completed' %}" class="text-decoration-none"
                            style="color: #198754;">
                            {{ completed }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">For Cancellation</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'for_cancellation' %}" class="text-decoration-none"
                            style="color: #e83e8c;">{{ for_cancellation }}</a>
                    </h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6">
            <div class="card text-center shadow-sm border-0 dashboard-card h-100">
                <div class="card-body py-4">
                    <h6 class="text-muted text-uppercase small mb-2">Cancelled</h6>
                    <h2 class="fw-bolder">
                        <a href="{% url 'survey_filter' 'cancelled' %}" class="text-decoration-none"
                            style="color: #dc3545;">
                            {{ cancelled }}
                        </a>
                    </h2>
                </div>
            </div>
        </div>

    </div>

    <div class="card shadow p-4 border-0" style="border-radius: 14px;">
        <h4 class="text-center fw-bold mb-4">Survey Status Chart</h4>
        <canvas id="statusPieChart" style="max-height: 360px;"></canvas>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('statusPieChart').getContext('2d');

    // Define consistent and UNIQUE colors for each stage (matching card inline styles)
    const pieChartBackgroundColors = [
        // Overlapping Clearance: Amber Yellow
        '#f8b800',
        // Parceling Stage: Bright Cyan
        '#00c0c0',
        // GIS Post: Dark Gray
        '#495057',
        // Survey Tool Access: Secondary Gray
        '#6c757d',
        // Survey Stage: Mid Green
        '#5cb85c',
        // Cluster ID Acquisition: Indigo Purple
        '#6f42c1',
        // HLD Submission: Vibrant Blue
        '#2070e0',
        // HLD Approval: Deep Orange
        '#fd7e14',
        // COMPLETED: Success Green
        '#198754',
        // For Cancellation: Magenta Pink
        '#e83e8c',
        // CANCELLED: Danger Red
        '#dc3545',
    ];

    // The labels define the order of the data and colors.
    const pieChartLabels = [
        'Overlapping', 'Parceling', 'GIS Post', 'Tool Access', 'Survey Stage',
        'Cluster ID', 'HLD Sub', 'HLD App', 'Completed', 'For Cancellation', 'Cancelled'
    ];

    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: pieChartLabels,
            datasets: [{
                data: [
                    Number("{{ overlapping }}"), Number("{{ parceling }}"), Number("{{ gis_post }}"),
                    Number("{{ tool_access }}"), Number("{{ survey_stage }}"), Number("{{ cluster_id }}"),
                    Number("{{ hld_submission }}"), Number("{{ hld_approval }}"),
                    Number("{{ completed }}"), Number("{{ for_cancellation }}"), Number("{{ cancelled }}")
                ],
                backgroundColor: pieChartBackgroundColors // Using the precise, matching colors
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { position: 'bottom' } }
        }
    });
</script>

{% else %}
<div class="container my-5">
    <div class="row align-items-center justify-content-center g-5 py-5">
        <div class="col-lg-6 text-center text-lg-start">
            <h1 class="display-3 fw-bold lh-1 mb-3">
                <span class="text-primary">Telecom</span> Project Tracker ðŸ“¶
            </h1>
            <p class="col-lg-10 fs-4 mb-4">
                Your **centralized platform** for managing **telecom construction projects** from initial planning and
                site survey all the way through to final invoicing and completion. Get real-time stage tracking and
                insights.
            </p>
            <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                <a href="{% url 'register' %}" class="btn btn-primary btn-lg px-4 me-md-2 fw-bold">ðŸš€ Get Started
                    Now</a>
                <a href="{% url 'login' %}" class="btn btn-outline-secondary btn-lg px-4">Already have an account? Log
                    In</a>
            </div>
        </div>
        <div class="col-10 col-sm-8 col-lg-6">

        </div>
    </div>
</div>

<footer class="footer fixed-bottom bg-light py-3">
    <center>
        <p>Copyright &copy; 2025 JohnJabZ<br>

            This project is released as open source.
            Permission is hereby granted to use, copy, modify, merge, publish, distribute,
            sublicense, and/or sell copies of the software, subject to the inclusion of this
            copyright notice in all copies or substantial portions of the software.<br>

            THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
            IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
            FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
            AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
            LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
            OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
            SOFTWARE.
        </p>
    </center>
</footer>
{% endif %}
{% endblock %}